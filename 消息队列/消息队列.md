# 消息队列

## 什么是消息队列

把消息队列看作一个存放消息的容器，当需要使用信息的时候，直接从容器中取出信息供我们使用。

> 使用消息队列的理由：通过异步处理提高系统性能和削峰、降低系统耦合性

## 使用消息队列的原因

### 通过异步处理提高系统性能

**一般流程**

> 1. 客户端 发送请求 服务端
> 2. 服务端 请求DB 
> 3. DB 返回结果 服务端
> 4. 服务端 返回响应 客户端

**整合消息队列**：将用户的请求数据存储到消息队列之后就立即返回结果。随后，系统再对消息进行消费。

> 1. 客户端 发送请求 服务端
> 2. 服务端 发送消息 消息队列
> 3. 服务端 返回响应 客户端
> 4. 消息队列 请求DB

例子：因为用户请求数据写入消息队列之后就立即返回给用户了，但是请求数据在后续的业务校验、写数据库等操作中可能失败。因此，**使用消息队列进行异步处理之后，需要适当修改业务流程进行配合**，比如用户在提交订单之后，订单数据写入消息队列，不能立即返回用户订单提交成功，需要在消息队列的订单消费者进程真正处理完该订单之后，甚至出库后，再通过电子邮件或短信通知用户订单成功，以免交易纠纷。这就类似我们平时手机订火车票和电影票。

