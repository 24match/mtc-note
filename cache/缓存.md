# 三种常用的缓存读写策略

## Cache Aside Pattern（旁路缓存模式）

> 比较常用的缓存读写模式，适用于读请求较多的场景

写：

+ 先更新DB
+ 然后直接删除cache

读：

+ 从cache中读取数据，读到就直接返回
+ cache中读取不到的话，就从DB中读取数据返回
+ 再把数据放到cache中

### 写数据过程中，可以先删除cache，再更新db吗？

不行，这样会造成db与cache数据不一致的问题。

> 请求1把cache中的A数据删除 -> 请求2从DB中读取数据 -> 请求1再把db中的A数据更新

### 写数据过程中，先更新db后删除cache？

理论上可能会出现数据不一致行的问题，但是概率很低，因为缓存的写入速度比db的写出速度快很多

> 请求1先读数据A，请求2随后写数据A，并且数据A不在缓存中的话也有可能产生数据不一致性的问题。

**缺陷1：首次请求数据一定不在cache的问题**

解决方法：将热点数据提前放入cache中

**缺陷2：写操作比较频繁的话会导致cache中的数据会频繁被删除，会影响缓存命中率**

解决方法：

+ 数据库和缓存数据强一致场景 ：更新DB的时候同样更新cache，不过我们需要加一个锁/分布式锁来保证更新cache的时候不存在线程安全问题。
+ 可以短暂地允许数据库和缓存数据不一致的场景 ：更新DB的时候同样更新cache，但是给缓存加一个比较短的过期时间，这样的话就可以保证即使数据不一致的话影响也比较小。

## Read/Write Through Pattern（读写穿透）

Read/Write Through Pattern中服务端把cache视为主要数据存储，从中读取数据并将数据写入其中。cache负责将此数据读取和写入db，从而减轻了应用程序的职责。

